# PATCHED WITH RELAYS : 
# I - HAIFA DOCUMENTATION
[haifa_documentation_pdf](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/HAIFA_DOCUMENTATION/All_haifa_documentation.pdf)

# II - INTERSTING KNOWLEDGE WITH HAIFA UDR
## Voltage range 

INPUT : 80V -> 260V and OUTPUT : 220V

## Power 

POWER : 500va; 1Kva; 1,5Kva; 2Kva; 3Kva; 5Kva; 10kva 

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of available power </summary>
        <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/DOCUMENTATION_INTERESTING_1.jpg"  alt="Image of documentation 1">
  </tr>
</table>


## Curve of minimal power :
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of minimal power on documentation </summary>
 <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/DOCUMENTATION_INTERESTING_2.jpg"  alt="Image of documentation 2">

  </tr>
</table>


eg : for stabilizer 2000va = 2000 * 0.7 W = 1400W  </br>
At 130v, 50% of power ... </br>
so at 210v, it's support 1000va = 1000 * 0,7 w = 700W , current will be near : = 700W/130V = 5,3846A </br>
At 80v, the power maximal power supported is : = 5,3846 * 80 V = 430 w  </br>
 
# III - ARDUINO IC CIRCUIT CONNECTION (PCB DOWN VIEW)
It's easy to follow the inteconnection with down view
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of arduino connection </summary>
 <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/ARDUINO_INTERCONNECTION_1.jpg"  alt="Image of documentation 2">

  </tr>
</table>

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of arduino connection about hardware </summary>
 <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/ARDUINO_INTERCONNECTION_2.jpg"  alt="Image of documentation 2">

  </tr>
</table>


<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of arduino connection about hardware (all in one) </summary>
 <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/ARDUINO_INTERCONNECTION_ALL.jpg"  alt="Image of documentation 2">

  </tr>
</table>

[arduino_connection_pdf](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/ARDUINO_INTERCONNECTION_ALL.pdf)

# IV - ARDUINO IC CIRCUIT CONNECTION (PCB TOP VIEW)
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of arduino connection top view </summary>
<img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/ARDUINO_INTECONNECTION_TOP_VIEW.jpg"  alt="Image des pins extra transformateur avec notation">

  </tr>
</table>


# V - RELAY CONNECTION
## Schematic 
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of relay connection </summary>
        <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/RELAY_INTERCONNECTION_1.JPG" alt="Image des pins extra transformateur">

  </tr>
</table>

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of relay connection about hardware </summary>
        <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/RELAY_INTERCONNECTION_2.jpg" alt="Image des pins extra transformateur avec notation">

  </tr>
</table>

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of relay connection about hardware (all in one) </summary>
        <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/RELAY_INTECONNECTION_ALL.jpg" alt="Image des pins extra transformateur avec notation">

  </tr>
</table>

[relay_connetion_pdf](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/RELAY_INTECONNECTION.pdf) </br>
[relay_connection_all_pdf](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/RELAY_INTECONNECTION_ALL.pdf) </br>

When command relay is HIGH -> MIDLE AND DOWN IS CONNECTED ON THE RELAY </br>
When command relay is LOW  -> MIDLE AND UP IS CONNECTED ON THE RELAY </br>

## Relay interconnection with all name

[schematic_with_all_notation](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/RELAY_INTECONNECTION_ALL_NAME.pdf)
</br>
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üßÆ click for having interconnection with all name </summary>
       <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/RELAY_INTECONNECTION_ALL_NAME.jpg"  alt="Image of relay interconnection with all name">       
<p> 
    FOR HARDWARE (NOTATION BEGINS BY ONE) </br>
    FOR SOFTWARE AKA CODING (NOTATION BEGINS BY ZERO) </br> </br>
    Equivalence between name's relay : R begin by zero and K begin by one  </br>
    R0 is K1 </br>
    R1 is K2 </br>
    R2 is K3 </br>
    ...</br>
    Equivalence between name's command relay : CR begin by zero and IN begin by one </br>
    CR0 is IN1 </br>
    CR1 is IN2 </br>
    CR2 is IN3 </br>
    ...
</p>
  </tr>
</table>
FOR HARDWARE (NOTATION BEGINS BY ONE) : Relay noted by KX and command noted by INX </br>
FOR SOFTWARE AKA CODING (NOTATION BEGINS BY ZERO) : Relady noted by RX and command noted by CRX </br> </br>


## Explanation by lookuptable

* Full complete guide of lookuptable in excel 

[lookuptable_excel](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LOOKUPTABLE_HAIFA.xlsx)
 </br>

* Resume lookuptable 

[lookuptable_pdf](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LOOKUPTABLE_HAIFA.pdf)
</br>

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üßÆ click for having LookUpTable </summary>
       <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LOOKUPTABLE_HAIFA.jpg"  alt="Image of lookuptable resume">
       
<p> 
             R1 : is to connect or not with voltage in of relay or 215 in of relay </br>
             R2 : is to connect or not with voltage out of relay </br>
             R3 - R7 : could be high for activation or low for no activation </br>
             IN_TAP : is interconnection with the intap of transformers  </br>
             OUT_TAP : is interconnection with the intap of transformers  </br>
             DIFF : is the differenciation between OUT_TAP and IN_TAP  </br>
             DEV : is the differenciation between 220V minus DIFF  </br>
             Tensions : is approximation interval for having near 220V at the output  </br>
             version8 : state choosen by the version 8 program </br>
             The last coulumn is the approximate VOLTAGE_TRANSITION_STATE (for each), it will be experimented at the INTEGRATION TEST OF CODE </br>             
</p>
  </tr>
</table>


# VI - ARDUINO + RELAY CONNECTION
## Schematic
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of arduino with relay </summary>
         <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/ARDUINO_RELAY.jpg"  alt="Image of arduino with relay">
  </tr>
</table>

## TESTING UNIT FOR ALL STATE

* stabilizer_tapping_state_all_on

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state_all_on.ino </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state_all_on.ino and upload + run </p>
        
         /* haifa with 8 relay : CR7 = D2, CR5 = D3, CR6= D4, CR4= D5, CR3= D6, CR2= D7, CR1 = D8 , CR0 = D9 de 2 √† 9 */
        void setup() {
          // put your setup code here, to run once:
          int stat=OUTPUT;
          pinMode(2, stat);
          pinMode(3, stat);
          pinMode(4, stat);
          pinMode(5, stat);
          pinMode(6, stat);
          pinMode(7, stat);
          pinMode(8, stat);
          pinMode(9, stat);
          Serial.begin(9600); 
        }

        void loop() {
          // LOW FOR ACTIVATION
          // HIGH FOR NO ACTIVATION
          // NO OUTPUT CONNECTED ON THE STABILIZER
          // ALL LED RELAY SHOULD BE ON
          int stat = LOW; // change for LOW and HIGH
          digitalWrite(2, stat);
          digitalWrite(3, stat);
          digitalWrite(4, stat);
          digitalWrite(5, stat);
          digitalWrite(6, stat);
          digitalWrite(7, stat);
          digitalWrite(8, stat);
          digitalWrite(9, stat);

          Serial.println("LED RELAY ALL ON");

        /*
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
        */ 

          delay(200);
        }
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state_all_on.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state_all_on.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state_security_voltage

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state_security_voltage.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state_security_voltage.ino and upload + run </p>
                    
    /*
    Programmed by Sitraka : In the hack we trust
    */
    
    int Relay0 = 9;
    int Relay1 = 8;
    int Relay2 = 7;
    int Relay3 = 6;
    int Relay4 = 5;
    int Relay6 = 4;
    int Relay5 = 3;
    int Relay7 = 2;
    
    void delayMillis(unsigned long duration) {
    unsigned long previousMillis = millis();  
    while (millis() - previousMillis < duration) {
    }
    }
    
    // ALL RELAY INACTIF : HIGH
    int Relay0_state = HIGH;
    int Relay1_state = HIGH;
    int Relay2_state = HIGH;
    int Relay3_state = HIGH;
    int Relay4_state = HIGH;
    int Relay5_state = HIGH;
    int Relay6_state = HIGH;
    int Relay7_state = HIGH;
    
    
    // NO OUTPUT for security of equipement
    // ALL LED OF RELAY IS OFF indeed RELAY0 or K1
    
    int normal = 0;
    void stabilizer_tapping_security_voltage(){
     // Something is anormal on voltage (really high or really low) 
     normal = 0;
     // Relay0 will be inactif so becomes HIGH
     if(Relay0_state == LOW){  
        digitalWrite(Relay0,HIGH); 
        delayMillis(5);
        Relay0_state = HIGH;
     }                        
    }
    
    void setup() {
    // put your setup code here, to run once:
    pinMode(Relay0, OUTPUT);
    pinMode(Relay1, OUTPUT);
    pinMode(Relay2, OUTPUT);
    pinMode(Relay3, OUTPUT);
    pinMode(Relay4, OUTPUT);
    pinMode(Relay5, OUTPUT);
    pinMode(Relay6, OUTPUT);
    pinMode(Relay7, OUTPUT);
    
    pinMode(A0, INPUT);
    
    // initialization :   
    digitalWrite(Relay0,HIGH);      
    digitalWrite(Relay1,HIGH);
    digitalWrite(Relay2,HIGH);
    digitalWrite(Relay3,HIGH);                    
    digitalWrite(Relay4,HIGH);                    
    digitalWrite(Relay5,HIGH);
    digitalWrite(Relay6,HIGH);
    digitalWrite(Relay7,HIGH);
    
    delay(50);
    Serial.begin(9600);
    }
    
    void loop() {
    // Don't activate this part of code to avoid blinking
    /*      
    if(Relay0_state == HIGH){
    digitalWrite(Relay0,LOW);
    delayMillis(5);
    Relay0_state = LOW;
    }
    */
    
    stabilizer_tapping_security_voltage();
    
    /*
    Serial.println("Relay0");      
    Serial.println(digitalRead(Relay0));      
    Serial.println("Relay1");      
    Serial.println(digitalRead(Relay1));      
    Serial.println("Relay2");      
    Serial.println(digitalRead(Relay2));      
    Serial.println("Relay3");      
    Serial.println(digitalRead(Relay3));      
    Serial.println("Relay4");      
    Serial.println(digitalRead(Relay4));      
    Serial.println("Relay5");      
    Serial.println(digitalRead(Relay5));      
    Serial.println("Relay6");      
    Serial.println(digitalRead(Relay6));      
    Serial.println("Relay7");      
    Serial.println(digitalRead(Relay7));      
    */ 
    
    delay(200);
    }
    
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state_security_voltage.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state_security.jpg"  alt="Image of result">
  </tr>
</table>
WHEN LEF OF RELAY ZERO IS OFF -> STABILIZER IS INACTIVE </br>
</br>

* stabilizer_tapping_state1_94_231
<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state1_94_231.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state1_94_231.ino and upload + run </p> 
        
    /*
    Programmed by Sitraka : In the hack we trust
    */
    
    int Relay0 = 9;
    int Relay1 = 8;
    int Relay2 = 7;
    int Relay3 = 6;
    int Relay4 = 5;
    int Relay6 = 4;
    int Relay5 = 3;
    int Relay7 = 2;
    
    void delayMillis(unsigned long duration) {
      unsigned long previousMillis = millis();  
      while (millis() - previousMillis < duration) {
      }
    }
    
    // ALL RELAY INACTIF : HIGH
    int Relay0_state = HIGH;
    int Relay1_state = HIGH;
    int Relay2_state = HIGH;
    int Relay3_state = HIGH;
    int Relay4_state = HIGH;
    int Relay5_state = HIGH;
    int Relay6_state = HIGH;
    int Relay7_state = HIGH;
    
    
    void setup() {
      // put your setup code here, to run once:
      pinMode(Relay0, OUTPUT);
      pinMode(Relay1, OUTPUT);
      pinMode(Relay2, OUTPUT);
      pinMode(Relay3, OUTPUT);
      pinMode(Relay4, OUTPUT);
      pinMode(Relay5, OUTPUT);
      pinMode(Relay6, OUTPUT);
      pinMode(Relay7, OUTPUT);
    
      pinMode(A0, INPUT);
    
      // initialization :   
      digitalWrite(Relay0,HIGH);      
      digitalWrite(Relay1,HIGH);
      digitalWrite(Relay2,HIGH);
      digitalWrite(Relay3,HIGH);                    
      digitalWrite(Relay4,HIGH);                    
      digitalWrite(Relay5,HIGH);
      digitalWrite(Relay6,HIGH);
      digitalWrite(Relay7,HIGH);
      
      delay(50);
      Serial.begin(9600);
    }
    
    void stabilizer_tapping_state1_94_231(){
      // Serial.println("voltage < VOLTAGE_TRANSITION_1");
      // STATE 1 ARDUINO RELAY: 
      // Relay1 -> Relay 7 : H H H H L L L
      // INPUT1 -> INPUT8 :L H H H H L L L
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 94V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_1 (near of 95)
      // verify interconnection of K2 MIDDLE and K8 UP
      // verify interconnection of K1 UP and K2 UP
      
      if(Relay1_state == LOW){
      digitalWrite(Relay1,HIGH);
      delayMillis(5);
      Relay1_state = HIGH;
      }
      
      if(Relay2_state == LOW){  
      digitalWrite(Relay2,HIGH);
      delayMillis(5);
      Relay2_state = HIGH;
      }   
      
      if(Relay3_state == LOW){ 
      digitalWrite(Relay3,HIGH);
      delayMillis(5);
      Relay3_state = HIGH;
      }
      
      if(Relay4_state == LOW){                        
      digitalWrite(Relay4,HIGH);
      delayMillis(5);
      Relay4_state = HIGH;
      }
      
      if(Relay5_state == HIGH){
      digitalWrite(Relay5,LOW);
      delayMillis(5);
      Relay5_state = LOW;
      }
      
      if(Relay6_state == HIGH){    
      digitalWrite(Relay6,LOW);
      delayMillis(5);
      Relay6_state = LOW;                        
      }
      
      if(Relay7_state == HIGH){    
      digitalWrite(Relay7,LOW);
      delayMillis(5);
      Relay7_state = LOW;                        
      }
    }
    
    void loop() {
      
      if(Relay0_state == HIGH){
      digitalWrite(Relay0,LOW);
      delayMillis(5);
      Relay0_state = LOW;
      }
    
      stabilizer_tapping_state1_94_231();
    /*
      Serial.println("Relay0");      
      Serial.println(digitalRead(Relay0));      
      Serial.println("Relay1");      
      Serial.println(digitalRead(Relay1));      
      Serial.println("Relay2");      
      Serial.println(digitalRead(Relay2));      
      Serial.println("Relay3");      
      Serial.println(digitalRead(Relay3));      
      Serial.println("Relay4");      
      Serial.println(digitalRead(Relay4));      
      Serial.println("Relay5");      
      Serial.println(digitalRead(Relay5));      
      Serial.println("Relay6");      
      Serial.println(digitalRead(Relay6));      
      Serial.println("Relay7");      
      Serial.println(digitalRead(Relay7));      
    */ 
      delay(200);
    }        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state1_94_231.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state1_94_231.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state2_94_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state2_94_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state2_94_215.ino and upload + run </p>
          
    /*
    Programmed by Sitraka : In the hack we trust
    */
    
    int Relay0 = 9;
    int Relay1 = 8;
    int Relay2 = 7;
    int Relay3 = 6;
    int Relay4 = 5;
    int Relay6 = 4;
    int Relay5 = 3;
    int Relay7 = 2;
    
    
    void delayMillis(unsigned long duration) {
      unsigned long previousMillis = millis(); 
      while (millis() - previousMillis < duration) {
      }
    }
    
    // ALL RELAY INACTIF : HIGH
    int Relay0_state = HIGH;
    int Relay1_state = HIGH;
    int Relay2_state = HIGH;
    int Relay3_state = HIGH;
    int Relay4_state = HIGH;
    int Relay5_state = HIGH;
    int Relay6_state = HIGH;
    int Relay7_state = HIGH;
    
    void stabilizer_tapping_state2_94_215(){
      // STATE 2 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L  H H L L L
      // INPUT1 -> INPUT8: L H  L  H H L L L
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 109V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_2 (near of 105V)
      // verify interconnection with K2 MIDDLE and K8 UP 
      // verify interconnection with K1 UP and K3 UP
       
      if(Relay1_state == LOW){
        digitalWrite(Relay1,HIGH);
        delayMillis(5);
        Relay1_state = HIGH;
      }
        
      if(Relay2_state == HIGH){  
        digitalWrite(Relay2,LOW);
        delayMillis(5);                        
        Relay2_state = LOW;
      }   
      if(Relay3_state == LOW){ 
        digitalWrite(Relay3,HIGH);
        delayMillis(5);                        
        Relay3_state = HIGH;
      }
      if(Relay4_state == LOW){                        
        digitalWrite(Relay4,HIGH);
        delayMillis(5);                        
        Relay4_state = HIGH;
      }
      if(Relay5_state == HIGH){                      
        digitalWrite(Relay5,LOW);
        delayMillis(5);                        
        Relay5_state = LOW;
      }
      if(Relay6_state == HIGH){    
        digitalWrite(Relay6,LOW);
        delayMillis(5);                        
        Relay6_state = LOW;                        
      }
      if(Relay7_state == HIGH){    
        digitalWrite(Relay7,LOW);
        delayMillis(5);                        
        Relay7_state = LOW;                        
      }  
    }
    
    void setup() {
      // put your setup code here, to run once:
      pinMode(Relay0, OUTPUT);
      pinMode(Relay1, OUTPUT);
      pinMode(Relay2, OUTPUT);
      pinMode(Relay3, OUTPUT);
      pinMode(Relay4, OUTPUT);
      pinMode(Relay5, OUTPUT);
      pinMode(Relay6, OUTPUT);
      pinMode(Relay7, OUTPUT);
    
      // initialization : 
      digitalWrite(Relay0,HIGH);
      digitalWrite(Relay1,HIGH);
      digitalWrite(Relay2,HIGH);
      digitalWrite(Relay3,HIGH);                    
      digitalWrite(Relay4,HIGH);                    
      digitalWrite(Relay5,HIGH);
      digitalWrite(Relay6,HIGH);
      digitalWrite(Relay7,HIGH);                   
      delay(50);
      Serial.begin(9600);
    }
    
    void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      stabilizer_tapping_state2_94_215();					  
                                         
    /*                    
        Serial.println("Relay0");      
        Serial.println(digitalRead(Relay0));      
        Serial.println("Relay1");      
        Serial.println(digitalRead(Relay1));      
        Serial.println("Relay2");      
        Serial.println(digitalRead(Relay2));      
        Serial.println("Relay3");      
        Serial.println(digitalRead(Relay3));      
        Serial.println("Relay4");      
        Serial.println(digitalRead(Relay4));      
        Serial.println("Relay5");      
        Serial.println(digitalRead(Relay5));      
        Serial.println("Relay6");      
        Serial.println(digitalRead(Relay6));      
        Serial.println("Relay7");      
        Serial.println(digitalRead(Relay7));      
    */ 
      delay(200);
    }        
            
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state2_94_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state2_94_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state3_109_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state3_109_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is stabilizer_tapping_state3_109_215.ino and upload + run </p>
        
    /*
    Programmed by Sitraka : In the hack we trust
    */
    
    int Relay0 = 9;
    int Relay1 = 8;
    int Relay2 = 7;
    int Relay3 = 6;
    int Relay4 = 5;
    int Relay6 = 4;
    int Relay5 = 3;
    int Relay7 = 2;
    
    
    void delayMillis(unsigned long duration) {
      unsigned long previousMillis = millis(); 
      while (millis() - previousMillis < duration) {
      }
    }
    
    // ALL RELAY INACTIF : HIGH
    int Relay0_state = HIGH;
    int Relay1_state = HIGH;
    int Relay2_state = HIGH;
    int Relay3_state = HIGH;
    int Relay4_state = HIGH;
    int Relay5_state = HIGH;
    int Relay6_state = HIGH;
    int Relay7_state = HIGH;
    
    
    void stabilizer_tapping_state3_109_215(){
    // STATE 3 ARDUINO RELAY: 
    // Relay1 -> Relay7  : H  L H H L L H
    // INPUT1 -> INPUT8: L H  L H H L L H
    // H means HIGH -> RELAY LED IS OFF
    // L means  LOW -> RELAY LED IS ON
    // inputtap = 109V and outpoutap = 215V
    // < VOLTAGE_TRANSITION_3 (near of 115V)
    // verify interconnection of K2 MIDDLE AND K8 DOWN 
    // verify interconnection of K1 UP AND K3 UP
    
     if(Relay1_state == LOW){
        digitalWrite(Relay1,HIGH);
        delayMillis(5);
        Relay1_state = HIGH;
      }
        
     if(Relay2_state == HIGH){  
        digitalWrite(Relay2,LOW);
        delayMillis(5);                        
        Relay2_state = LOW;
     }   
     if(Relay3_state == LOW){ 
        digitalWrite(Relay3,HIGH);
        delayMillis(5);                        
        Relay3_state = HIGH;
     }
     if(Relay4_state == LOW){                        
        digitalWrite(Relay4,HIGH);
        delayMillis(5);                        
        Relay4_state = HIGH;
     }
     if(Relay5_state == HIGH){                      
        digitalWrite(Relay5,LOW);
        delayMillis(5);                        
        Relay5_state = LOW;
     }
     if(Relay6_state == HIGH){    
        digitalWrite(Relay6,LOW);
        delayMillis(5);                        
        Relay6_state = LOW;                        
     }
     if(Relay7_state == LOW){    
        digitalWrite(Relay7,HIGH);
        delayMillis(5);                        
        Relay7_state = HIGH;                        
     }
     
    }
    
    void setup() {
      // put your setup code here, to run once:
      pinMode(Relay0, OUTPUT);
      pinMode(Relay1, OUTPUT);
      pinMode(Relay2, OUTPUT);
      pinMode(Relay3, OUTPUT);
      pinMode(Relay4, OUTPUT);
      pinMode(Relay5, OUTPUT);
      pinMode(Relay6, OUTPUT);
      pinMode(Relay7, OUTPUT);
            
      // initialization : 
      digitalWrite(Relay0,HIGH);
      digitalWrite(Relay1,HIGH);
      digitalWrite(Relay2,HIGH);
      digitalWrite(Relay3,HIGH);                    
      digitalWrite(Relay4,HIGH);                    
      digitalWrite(Relay5,HIGH);
      digitalWrite(Relay6,HIGH);
      digitalWrite(Relay7,HIGH);                   
      delay(50);
      Serial.begin(9600);
    }
    
    void loop() {
    
    if(Relay0_state == HIGH){
      digitalWrite(Relay0,LOW);
      Relay0_state = LOW;
    }
    					  
    stabilizer_tapping_state3_109_215();                                       
    /*                    
        Serial.println("Relay0");      
        Serial.println(digitalRead(Relay0));      
        Serial.println("Relay1");      
        Serial.println(digitalRead(Relay1));      
        Serial.println("Relay2");      
        Serial.println(digitalRead(Relay2));      
        Serial.println("Relay3");      
        Serial.println(digitalRead(Relay3));      
        Serial.println("Relay4");      
        Serial.println(digitalRead(Relay4));      
        Serial.println("Relay5");      
        Serial.println(digitalRead(Relay5));      
        Serial.println("Relay6");      
        Serial.println(digitalRead(Relay6));      
        Serial.println("Relay7");      
        Serial.println(digitalRead(Relay7));      
    */ 
      delay(200);
    }        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state3_109_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state3_109_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state4_127_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state4_127_215.ino </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state4_127_215.ino and upload + run </p>

      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      
      void stabilizer_tapping_state4_127_215(){
      // STATE 4 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H H L H X
      // INPUT1 -> INPUT8: L H  L H H L H X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 127V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_4 (near of 132V)
      // verify interconnection of K2 MIDDLE AND K7 DOWN 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
       }
       if(Relay5_state == HIGH){                      
          digitalWrite(Relay5,LOW);
          delayMillis(5);                        
          Relay5_state = LOW;
       }
       if(Relay6_state == LOW){    
          digitalWrite(Relay6,HIGH);
          delayMillis(5);                        
          Relay6_state = HIGH;                        
       }
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
        
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      
      stabilizer_tapping_state4_127_215();
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state4_127_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state4_127_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state5_148_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state5_148_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state5_148_215.ino and upload + run </p>
        
      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      
      void stabilizer_tapping_state5_148_215(){
      // STATE 5 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H H H X X
      // INPUT1 -> INPUT8: L H  L H H H X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 148V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_5 (near of 153)
      // verify interconnection of K2 MIDDLE AND K6 DOWN 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
       }
       if(Relay5_state == LOW){                      
          digitalWrite(Relay5,HIGH);
          delayMillis(5);                        
          Relay5_state = HIGH;
       }
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      stabilizer_tapping_state5_148_215();					  
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state5_148_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state5_148_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state6_171_231

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state6_171_231.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state6_171_231.ino and upload + run </p>
      
      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      void stabilizer_tapping_state6_171_231(){
      // STATE 6 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  H H L X X X
      // INPUT1 -> INPUT8: L H  H H L X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 171V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_6 (near of 160)
      // verify interconnection of K2 MIDDLE AND K5 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == HIGH){                        
          digitalWrite(Relay4,LOW);
          delayMillis(5);                        
          Relay4_state = LOW;
       }
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      
      stabilizer_tapping_state6_171_231();					  
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }        
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state6_171_231.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state6_171_231.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* stabilizer_tapping_state7_171_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state7_171_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state7_171_215.ino and upload + run </p>
      
      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      void stabilizer_tapping_state7_171_215(){
        
      // STATE 7 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H L X X X
      // INPUT1 -> INPUT8: L H  L H L X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 171V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_7 (near of 176)
      // verify interconnection of K2 MIDDLE AND K5 UP 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == HIGH){                        
          digitalWrite(Relay4,LOW);
          delayMillis(5);                        
          Relay4_state = LOW;
       }
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
         
      }
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      					  
      stabilizer_tapping_state7_171_215();                                      
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }        
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state7_171_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state7_171_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>


* stabilizer_tapping_state8_199_231

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state8_199_231.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state8_199_231.ino and upload + run </p>
      
      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      
      void stabilizer_tapping_state8_199_231(){
      // STATE 8 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  H L X X X X
      // INPUT1 -> INPUT8: L H  H L X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 199V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_8 (near of 188)
      // verify interconnection of K2 MIDDLE AND K4 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       if(Relay3_state == HIGH){ 
          digitalWrite(Relay3,LOW);
          delayMillis(5);                        
          Relay3_state = LOW;
       }
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
        
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      					  
      stabilizer_tapping_state8_199_231();
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }        
              
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state8_199_231.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state8_199_231.jpg"  alt="Image of result">
  </tr>
</table>
</br>


* stabilizer_tapping_state9_199_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state9_199_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state9_199_215.ino and upload + run </p>

        /*
        Programmed by Sitraka : In the hack we trust
        */
        
        int Relay0 = 9;
        int Relay1 = 8;
        int Relay2 = 7;
        int Relay3 = 6;
        int Relay4 = 5;
        int Relay6 = 4;
        int Relay5 = 3;
        int Relay7 = 2;
        
        
        void delayMillis(unsigned long duration) {
          unsigned long previousMillis = millis(); 
          while (millis() - previousMillis < duration) {
          }
        }
        
        // ALL RELAY INACTIF : HIGH
        int Relay0_state = HIGH;
        int Relay1_state = HIGH;
        int Relay2_state = HIGH;
        int Relay3_state = HIGH;
        int Relay4_state = HIGH;
        int Relay5_state = HIGH;
        int Relay6_state = HIGH;
        int Relay7_state = HIGH;
        
        void stabilizer_tapping_state9_199_215(){
          
        // STATE 9 ARDUINO RELAY: 
        // Relay1 -> Relay7  : H  L L X X X X
        // INPUT1 -> INPUT8: L H  L L X X X X
        // H means HIGH -> RELAY LED IS OFF
        // L means  LOW -> RELAY LED IS ON
        // inputtap = 199V and outpoutap = 215V
        // < VOLTAGE_TRANSITION_9 (near of 204)
        // verify interconnection of K2 MIDDLE AND K4 UP 
        // verify interconnection of K1 UP AND K3 UP
        
         if(Relay1_state == LOW){
            digitalWrite(Relay1,HIGH);
            delayMillis(5);
            Relay1_state = HIGH;
          }
            
         if(Relay2_state == HIGH){  
            digitalWrite(Relay2,LOW);
            delayMillis(5);                        
            Relay2_state = LOW;
         }   
         if(Relay3_state == HIGH){ 
            digitalWrite(Relay3,LOW);
            delayMillis(5);                        
            Relay3_state = LOW;
         }
         //if(Relay4_state == HIGH){                        
         //   digitalWrite(Relay4,LOW);
         //   delayMillis(5);                        
         //   Relay4_state = LOW;
         //}
         //if(Relay5_state == LOW){                      
         //   digitalWrite(Relay5,HIGH);
         //   delayMillis(5);                        
         //   Relay5_state = HIGH;
         //}
         //if(Relay6_state == LOW){    
         //   digitalWrite(Relay6,HIGH);
         //   delayMillis(5);                        
         //   Relay6_state = HIGH;                        
         //}
         //if(Relay7_state == LOW){    
         //   digitalWrite(Relay7,HIGH);
         //   delayMillis(5);                        
         //   Relay7_state = HIGH;                        
         //}
        
        }
        
        void setup() {
          // put your setup code here, to run once:
          pinMode(Relay0, OUTPUT);
          pinMode(Relay1, OUTPUT);
          pinMode(Relay2, OUTPUT);
          pinMode(Relay3, OUTPUT);
          pinMode(Relay4, OUTPUT);
          pinMode(Relay5, OUTPUT);
          pinMode(Relay6, OUTPUT);
          pinMode(Relay7, OUTPUT);
                
          // initialization : 
          digitalWrite(Relay0,HIGH);
          digitalWrite(Relay1,HIGH);
          digitalWrite(Relay2,HIGH);
          digitalWrite(Relay3,HIGH);                    
          digitalWrite(Relay4,HIGH);                    
          digitalWrite(Relay5,HIGH);
          digitalWrite(Relay6,HIGH);
          digitalWrite(Relay7,HIGH);                   
          delay(50);
          Serial.begin(9600);
        }
        
        void loop() {
        
        if(Relay0_state == HIGH){
          digitalWrite(Relay0,LOW);
          Relay0_state = LOW;
        }
        					  
        stabilizer_tapping_state9_199_215();
                                               
        /*                    
            Serial.println("Relay0");      
            Serial.println(digitalRead(Relay0));      
            Serial.println("Relay1");      
            Serial.println(digitalRead(Relay1));      
            Serial.println("Relay2");      
            Serial.println(digitalRead(Relay2));      
            Serial.println("Relay3");      
            Serial.println(digitalRead(Relay3));      
            Serial.println("Relay4");      
            Serial.println(digitalRead(Relay4));      
            Serial.println("Relay5");      
            Serial.println(digitalRead(Relay5));      
            Serial.println("Relay6");      
            Serial.println(digitalRead(Relay6));      
            Serial.println("Relay7");      
            Serial.println(digitalRead(Relay7));      
        */ 
          delay(200);
        }        
                
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state9_199_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state9_199_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>


* stabilizer_tapping_state10_231_231

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state10_231_231.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state10_231_231.ino and upload + run </p>
              
      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      
      void stabilizer_tapping_state10_231_231(){  
      // STATE 10 ARDUINO RELAY: 
      // Relay1 -> Relay7  : L  H X X X X X
      // INPUT1 -> INPUT8: L L  H X X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 231V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_10 (near of 235)
      // verify interconnection of K2 MIDDLE AND K2 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == HIGH){
          digitalWrite(Relay1,LOW);
          delayMillis(5);
          Relay1_state = LOW;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       //if(Relay3_state == HIGH){ 
       //   digitalWrite(Relay3,LOW);
       //   delayMillis(5);                        
       //   Relay3_state = LOW;
       //}
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
        
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
      					  
      stabilizer_tapping_state10_231_231();
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state10_231_231.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state10_231_231.jpg"  alt="Image of result">
  </tr>
</table>
</br>



* stabilizer_tapping_state11_231_215

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_state11_231_215.ino  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_state11_131_215.ino and upload + run </p>

      /*
      Programmed by Sitraka : In the hack we trust
      */
      
      int Relay0 = 9;
      int Relay1 = 8;
      int Relay2 = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis(); 
        while (millis() - previousMillis < duration) {
        }
      }
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH;
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      void stabilizer_tapping_state11_231_215(){
      // STATE 11 ARDUINO RELAY: 
      // Relay1 -> Relay7  : L  L X X X X X
      // INPUT1 -> INPUT8: L L  L X X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 231V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_11 (near of 260)
      // verify interconnection of K2 MIDDLE AND K2 UP 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == HIGH){
          digitalWrite(Relay1,LOW);
          delayMillis(5);
          Relay1_state = LOW;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       //if(Relay3_state == HIGH){ 
       //   digitalWrite(Relay3,LOW);
       //   delayMillis(5);                        
       //   Relay3_state = LOW;
       //}
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
        
      }
      
      void setup() {
        // put your setup code here, to run once:
        pinMode(Relay0, OUTPUT);
        pinMode(Relay1, OUTPUT);
        pinMode(Relay2, OUTPUT);
        pinMode(Relay3, OUTPUT);
        pinMode(Relay4, OUTPUT);
        pinMode(Relay5, OUTPUT);
        pinMode(Relay6, OUTPUT);
        pinMode(Relay7, OUTPUT);
              
        // initialization : 
        digitalWrite(Relay0,HIGH);
        digitalWrite(Relay1,HIGH);
        digitalWrite(Relay2,HIGH);
        digitalWrite(Relay3,HIGH);                    
        digitalWrite(Relay4,HIGH);                    
        digitalWrite(Relay5,HIGH);
        digitalWrite(Relay6,HIGH);
        digitalWrite(Relay7,HIGH);                   
        delay(50);
        Serial.begin(9600);
      }
      
      void loop() {
      
      if(Relay0_state == HIGH){
        digitalWrite(Relay0,LOW);
        Relay0_state = LOW;
      }
                  
      stabilizer_tapping_state11_231_215();
                                             
      /*                    
          Serial.println("Relay0");      
          Serial.println(digitalRead(Relay0));      
          Serial.println("Relay1");      
          Serial.println(digitalRead(Relay1));      
          Serial.println("Relay2");      
          Serial.println(digitalRead(Relay2));      
          Serial.println("Relay3");      
          Serial.println(digitalRead(Relay3));      
          Serial.println("Relay4");      
          Serial.println(digitalRead(Relay4));      
          Serial.println("Relay5");      
          Serial.println(digitalRead(Relay5));      
          Serial.println("Relay6");      
          Serial.println(digitalRead(Relay6));      
          Serial.println("Relay7");      
          Serial.println(digitalRead(Relay7));      
      */ 
        delay(200);
      }        
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of stabilizer_tapping_state11_231_215.ino </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/stabilizer_tapping_state11_231_215.jpg"  alt="Image of result">
  </tr>
</table>
</br>
        
[stabilizer_tapping_state_code_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/STABILIZER_TAPPING_STATE.zip)</br>
</br>

# VII - ARDUINO + SENSOR VOLTAGE (ZMPT101B)
* Schematic

For easly setup, use power_plug for the input of sensor voltage and output sensor voltage

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image of power_plug (input and output)  </summary>
<img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/POWER_PLUG.jpg"  alt="Image of global coding">
  </tr>
</table>

* librairies

[filters_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/Filters-master.zip) </br>
[zmpt101b_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/zmpt101b.zip) </br>

* Calibration

Calibrate the sensor when the voltage is near of 220V </br>
Do calibration for involtage and outvoltage </br>


<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : calibration  </summary>
        <p> Copy this code on arduino, save as the name is  calibration and upload + run </p>

      #include <FilterDerivative.h>
      #include <Filters.h>
      
      float testFrequency = 50;            // Fr√©quence of filter (Hz)
      float windowLength = 40.0 / testFrequency; // mean duration of the involtage or outvoltage for doing statistics 
      
      int outSensor = 0;                      // Analog input for the senor , initialized by zero 0 but changed after as analogRead of A3
      int inSensor = 0;                      // Analog input for the senor , initialized by zero 0 but changed after as analogRead of A2
      
      float intercept = -0.04;             // For adjusting the test calibration result
      //float slope = 0.03905;                // For adjusting the test calibration for involtage or outvoltage
      float slope1 = 2.59;                // For adjusting the test calibration for involtage or outvoltage
      float slope2 = 2.60;                // For adjusting the test calibration for involtage or outvoltage
      
      float output_Volts;                 // The voltage after stabilization
      float input_Volts;                 // The voltage befor stabilization
      
      unsigned long printPeriod = 1000;    // rate of update time (ms)
      unsigned long previousMillis = 0;
      
      unsigned long warmUpTime = 8000; // Time to wait for initialization of the voltage sensor to collect all data before RMS is 8 secondes
      bool isWarmUpComplete = false; // boolean to said that warmUpTime is complete
      unsigned long startTime = millis(); // Time of beginning
      
      
      // Frequency is really important so delay with interruption couldn't be used 
      // USE instead delay with millis so i create this function delayMillis() for that
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis();   
        while (millis() - previousMillis < duration) {
        }
      }
      
      
      
      
      void setup() {
        // initialization of serial port
        Serial.begin(9600);    
      
        // initialization of involtage and outvoltage
        pinMode(A2, INPUT);
        pinMode(A3, INPUT);
        
        delay(20);
        
      }
      
      void loop() {
        RunningStatistics outputStats;                  // Calcul facile des statistiques, dont la valeur RMS pour la tension output
        outputStats.setWindowSecs(windowLength);
        
        RunningStatistics inputStats;                  // Calcul facile des statistiques, dont la valeur RMS pour la tension input
        inputStats.setWindowSecs(windowLength);
        
        while (true) {
          outSensor = analogRead(A3);                     // Lire la valeur analogique
          outputStats.input(outSensor);                    // Enregistrer dans la fonction Stats
        
          inSensor = analogRead(A2);                     // Lire la valeur analogique
          inputStats.input(inSensor);                    // Enregistrer dans la fonction Stats
        
        
        if(isWarmUpComplete == false){  
            // initialization relay: 
        }
        
           
          // verify if the time to wait for having all rms data of input voltage is complete
          if (millis() - startTime >= warmUpTime) {
            //initialization_relay_state_arduino_relay();
            //initialization_relay_arduino_relay();            
            isWarmUpComplete = true;
          }
        
        
          // the time to wait for having all rms data of input voltage is complete
          if (((unsigned long)(millis() - previousMillis) >= printPeriod) && isWarmUpComplete){
            previousMillis = millis();                 // update timing
        
            output_Volts = intercept + slope2 * outputStats.sigma(); // do calibration of offset and amplitude for output voltage
            output_Volts = output_Volts;                // do calibration of offset and amplitude for output voltage
        
            input_Volts = intercept + slope1 * inputStats.sigma(); // do calibration of offset and amplitude for input voltage
            input_Volts = input_Volts;                // do calibration of offset and amplitude for input voltage
        
            Serial.println("input_Volts ");
            Serial.println(input_Volts);
            
            Serial.println("output_Volts ");
            Serial.println(output_Volts);
            Serial.println("");
      
          }
        }
      }        
      
  </tr>
</table>  

* software calibration 

Change this part of the code and do only calibration near 220V

```
float slope1 = 2.59;                // For adjusting the test calibration for involtage or outvoltage
float slope2 = 2.60;                // For adjusting the test calibration for involtage or outvoltage
```

* hardware calibration

Turn the potentiometer

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for calibration potentiometer </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/POT_CALIBRATION.jpg"  alt="Image of result">
  </tr>
</table>
</br>


# VIII - ARDUINO + LCD OLED OR LCDx1602
## LCDx1602

* scan i2c lcd

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : scan_i2c_lcd.ino  </summary>
        <p> Copy this code on arduino, save as the name is  scan_i2c_lcd.ino  and upload + run </p>
      
      // SPDX-FileCopyrightText: 2023 Carter Nelson for Adafruit Industries
      //
      // SPDX-License-Identifier: MIT
      // --------------------------------------
      // i2c_scanner
      //
      // Modified from https://playground.arduino.cc/Main/I2cScanner/
      // --------------------------------------
      
      #include <Wire.h>
      
      // Set I2C bus to use: Wire, Wire1, etc.
      #define WIRE Wire
      
      void setup() {
        WIRE.begin();
      
        Serial.begin(9600);
        while (!Serial)
           delay(10);
        Serial.println("\nI2C Scanner");
      }
      
      
      void loop() {
        byte error, address;
        int nDevices;
      
        Serial.println("Scanning...");
      
        nDevices = 0;
        for(address = 1; address < 127; address++ )
        {
          // The i2c_scanner uses the return value of
          // the Write.endTransmisstion to see if
          // a device did acknowledge to the address.
          WIRE.beginTransmission(address);
          error = WIRE.endTransmission();
      
          if (error == 0)
          {
            Serial.print("I2C device found at address 0x");
            if (address<16)
              Serial.print("0");
            Serial.print(address,HEX);
            Serial.println("  !");
      
            nDevices++;
          }
          else if (error==4)
          {
            Serial.print("Unknown error at address 0x");
            if (address<16)
              Serial.print("0");
            Serial.println(address,HEX);
          }
        }
        if (nDevices == 0)
          Serial.println("No I2C devices found\n");
        else
          Serial.println("done\n");
      
        delay(5000);           // wait 5 seconds for next scan
      }        
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of scan_i2c_lcd.ino  </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/SCAN_I2C_LCD.JPG"  alt="Image of result">
  </tr>
</table>
</br>  

Choose this adress on the code

* hardware interconnection
  
<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of hardware connection with lcd 1602 </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LCD_I2C_1602.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* librairies

[liquid_crystal_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LiquidCrystal_I2C-1.1.2.zip) </br>
[scan_i2c_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/scan_i2c.zip) </br>
[hello_world_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/hello_world_lcd_1602.zip) </br>

* print hello world in each line

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : hellooworld_lcd_1602.ino  </summary>
        <p> Copy this code on arduino, save as the name is  hellooworld_lcd_1602.ino and upload + run </p>

        #include <Wire.h>
        #include <LiquidCrystal_I2C.h>
        
        // Initialize the LCD with I2C address 0x27 (common) or 0x3F (alternative)
        LiquidCrystal_I2C lcd(0x27, 16, 2);  // (I2C address, columns, rows)
        
        void setup() {
          lcd.init();        // Initialize the LCD
          lcd.backlight();   // Turn on the backlight
        
          lcd.setCursor(0, 0); // Move cursor to first row, first column
          lcd.print("Hello World"); // Print on first row
        
          lcd.setCursor(0, 1); // Move cursor to second row, first column
          lcd.print("Hello World 2"); // Print on second row
        }
        
        void loop() {
          // No need to put anything here unless you want animations
        }
                
  </tr>
</table>  

 
## LCD OLED

* scan lcd
<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : scan_i2c_lcd.ino  </summary>
        <p> Copy this code on arduino, save as the name is  scan_i2c_lcd.ino  and upload + run </p>
      
      // SPDX-FileCopyrightText: 2023 Carter Nelson for Adafruit Industries
      //
      // SPDX-License-Identifier: MIT
      // --------------------------------------
      // i2c_scanner
      //
      // Modified from https://playground.arduino.cc/Main/I2cScanner/
      // --------------------------------------
      
      #include <Wire.h>
      
      // Set I2C bus to use: Wire, Wire1, etc.
      #define WIRE Wire
      
      void setup() {
        WIRE.begin();
      
        Serial.begin(9600);
        while (!Serial)
           delay(10);
        Serial.println("\nI2C Scanner");
      }
      
      
      void loop() {
        byte error, address;
        int nDevices;
      
        Serial.println("Scanning...");
      
        nDevices = 0;
        for(address = 1; address < 127; address++ )
        {
          // The i2c_scanner uses the return value of
          // the Write.endTransmisstion to see if
          // a device did acknowledge to the address.
          WIRE.beginTransmission(address);
          error = WIRE.endTransmission();
      
          if (error == 0)
          {
            Serial.print("I2C device found at address 0x");
            if (address<16)
              Serial.print("0");
            Serial.print(address,HEX);
            Serial.println("  !");
      
            nDevices++;
          }
          else if (error==4)
          {
            Serial.print("Unknown error at address 0x");
            if (address<16)
              Serial.print("0");
            Serial.println(address,HEX);
          }
        }
        if (nDevices == 0)
          Serial.println("No I2C devices found\n");
        else
          Serial.println("done\n");
      
        delay(5000);           // wait 5 seconds for next scan
      }        
        
  </tr>
</table>  

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of scan_i2c_lcd.ino  </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/SCAN_I2C_OLED.JPG"  alt="Image of result">
  </tr>
</table>
</br>  

Choose this adress on the code

* hardware interconnection

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image result of hardware connection with lcd 1602 </summary>
         <img src="https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/LCD_OLED.jpg"  alt="Image of result">
  </tr>
</table>
</br>

* librairies

[scan_i2c_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/scan_i2c.zip) </br>
[adafruit_gfx_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/Adafruit_GFX_Library-1.12.0.zip) </br>
[adafruit_ssd_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/Adafruit_SSD1306-2.5.13.zip) </br>
[hello_world_oled_zip](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/hello_world_lcd_oled.zip) </br>


* print hello in each line

<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : hellooworld_lcd_1602.ino  </summary>
        <p> Copy this code on arduino, save as the name is  hellooworld_lcd_1602.ino and upload + run </p>

        #include <Wire.h>
        #include <Adafruit_GFX.h>
        #include <Adafruit_SSD1306.h>
        
        // Taille de l'√©cran OLED
        #define SCREEN_WIDTH 128
        #define SCREEN_HEIGHT 32
        
        // Adresse I2C de l'√©cran OLED (0x3C pour la plupart des √©crans)
        #define OLED_ADDRESS 0x3C
        
        // Initialisation de l'√©cran OLED
        Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);
        
        void setup() {
            if (!display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDRESS)) {
                Serial.println(F("√âchec de l'initialisation de l'√©cran OLED"));
                for (;;);
            }
        
            display.clearDisplay();  // Effacer l'√©cran
        
            display.setTextSize(2);  // Taille du texte (2x plus grand)
            display.setTextColor(SSD1306_WHITE);
        
            // Affichage du premier texte
            display.setCursor(0, 0);  // Position ajust√©e
            display.print("Hello ");
         
            // Affichage du deuxi√®me texte
            display.setCursor(0, 16);  // Seconde ligne
            display.print("Hello 2");
        
            display.display();  // Mettre √† jour l'√©cran
        }
        
        void loop() {
            // Rien dans la loop car le texte est statique
        }

  </tr>
</table>  


# IV - INTEGRATION CODE
[schematic_global_coding](https://github.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/blob/main/PATCHED_WITH_RELAY/GLOBAL_CODING.pdf)

<table border="1" cellpadding="10">
  <tr>
    <td>
      <details>
        <summary>üñºÔ∏è Click for having image the hardware and integration code  </summary>
<img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/GLOBAL_CODING.jpg"  alt="Image of global coding">
  </tr>
</table>


<table border="1" cellpadding="10">
  <tr>
    <td>
        <details>
        <summary>üìë Click for having code : stabilizer_tapping_v8  </summary>
        <p> Copy this code on arduino, save as the name is  stabilizer_tapping_v8.ino and upload + run </p>
          
      // This code is for arduino relay witch has low activation not relay haifa with high activation 
      // --> LOW ACTIVATION means all initialization in HIGH)
      
      /*
       * This code use also ZMPT101B with SERIAL DEBUGGING, LCD 1602 PRINTING AND OLED 128x32 PRINTING
       * The maximal voltage with ZMPT101B is 250V, PAY ATTENTION !!! 
       * The librairies filters has many functions permitting to calculate the RMS value of input voltage.
       */
      
      /*LIQUID CRYSTAL PARAMETERS*/
      #include <LiquidCrystal_I2C.h>
      LiquidCrystal_I2C lcd(0x27, 16, 2);
      
      /*OLED PARAMETERS*/
      #include <Wire.h>
      #include <Adafruit_GFX.h>
      #include <Adafruit_SSD1306.h>
      
      // SIZE OF SCREEN
      #define SCREEN_WIDTH 128
      #define SCREEN_HEIGHT 32
      
      // Adresse I2C of OLED (0x3C but usse 0x3D if not)
      #define OLED_ADDRESS 0x3C
      
      // Initialization of OLED
      Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, -1);
      
      
      /*SENSORS PARAMETERS */
      #include <FilterDerivative.h>
      #include <Filters.h>
      float testFrequency = 50;            // Fr√©quence of filter (Hz)
      float windowLength = 40.0 / testFrequency; // mean duration of the involtage or outvoltage for doing statistics 
      
      int outSensor = 0;                      // Analog input for the senor , initialized by zero 0 but changed after as analogRead of A3
      int inSensor = 0;                      // Analog input for the senor , initialized by zero 0 but changed after as analogRead of A2
      
      float intercept = -0.04;             // For adjusting the test calibration result
      //float slope = 0.03905;                // For adjusting the test calibration for involtage or outvoltage
      float slope1 = 2.59;                // For adjusting the test calibration for involtage or outvoltage
      float slope2 = 2.60;                // For adjusting the test calibration for involtage or outvoltage
      
      float output_Volts;                 // The voltage after stabilization
      float input_Volts;                 // The voltage befor stabilization
      
      unsigned long printPeriod = 1000;    // rate of update time (ms)
      unsigned long previousMillis = 0;
      
      unsigned long warmUpTime = 8000; // Time to wait for initialization of the voltage sensor to collect all data before RMS is 8 secondes
      bool isWarmUpComplete = false; // boolean to said that warmUpTime is complete
      unsigned long startTime = millis(); // Time of beginning
      
      
      /*
      VOLTAGE TRANSITION CONFIGURATION
      */
      
      // Minus is the calibration of voltage transition , 
      // no calibration, it will be 0
      // more high output, it will  be negatif as eg : -3
      // more low output, it will be positif as eg : +3
      #define MINIUS 0
      
      #define VOLTAGE_TRANSITION_1 100-MINIUS //first transition is near 90V 
      #define VOLTAGE_TRANSITION_2 110-MINIUS //second transition is near 105
      #define VOLTAGE_TRANSITION_3 124-MINIUS // third transition is near 115 //interesting
      #define VOLTAGE_TRANSITION_4 137-MINIUS // fourth transition is near 130 //The first modif 145
      #define VOLTAGE_TRANSITION_5 155-MINIUS // fifth transition is near 150
      #define VOLTAGE_TRANSITION_6 165-MINIUS // sixth transition is near 160
      #define VOLTAGE_TRANSITION_7 185-MINIUS // seventh transition is near 175
      #define VOLTAGE_TRANSITION_8 200-MINIUS // eigth transition is near 190
      #define VOLTAGE_TRANSITION_9 210-MINIUS // ninetransition is near 205
      #define VOLTAGE_TRANSITION_10 230-MINIUS // ninetransition is near 230
      #define VOLTAGE_TRANSITION_11 255-MINIUS // ninetransition is near 255
      
      // SECURITY VOLTAGE
      #define VOLTAGE_SECURITY_LOW 45
      #define VOLTAGE_SECURITY_HIGH VOLTAGE_TRANSITION_11+5
      
      #define HYSTERESIS 2
      
      unsigned int V_DIFFERENCE;
      unsigned int Voltage_INT;
      unsigned int oldVoltage;
      //unsigned int Voltage_INT_PREV;
      //unsigned char INPUT_TAPPING;
      //unsigned char OUTPUT_TAPPING;
      //unsigned char oldInput;
      
      
      int normal = 0;
      
      //unsigned int Voltage_OUT_APPROX;
      //void approximate_output_voltage(unsigned int input_tapping, unsigned int output_tapping){
      //     Voltage_OUT_APPROX = Voltage_INT+output_tapping-input_tapping;
      //     Voltage_OUT_APPROX_PREV = Voltage_INT_PREV+output_tapping-input_tapping; //should correct with PREV inputtapping and outputtapping
      //}
      
      /* PIN OF ALL RELAY */
      int Relay0 =  9;
      int Relay1 = 8;
      int Relay2  = 7;
      int Relay3 = 6;
      int Relay4 = 5;
      int Relay6 = 4;
      int Relay5 = 3;
      int Relay7 = 2;
      
      // ALL RELAY INACTIF : HIGH
      int Relay0_state = HIGH; // -> it will become LOW for activated the relay 
      int Relay1_state = HIGH;
      int Relay2_state = HIGH;
      int Relay3_state = HIGH;
      int Relay4_state = HIGH;
      int Relay5_state = HIGH;
      int Relay6_state = HIGH;
      int Relay7_state = HIGH;
      
      // initialization relay_state
      void initialization_relay_state_arduino_relay(){  
          Relay0_state = HIGH;
          Relay1_state = HIGH;
          Relay2_state = HIGH;
          Relay3_state = HIGH;
          Relay4_state = HIGH;
          Relay5_state = HIGH;
          Relay6_state = HIGH;
          Relay7_state = HIGH;
      }
      void initialization_relay_arduino_relay(){
        // When stabilization run, the activation should be at the last part of code
        digitalWrite(Relay0,HIGH); 
        delayMillis(5);
        
        digitalWrite(Relay1,HIGH);
      //  delayMillis(5);  
        digitalWrite(Relay2,HIGH);
      //  delayMillis(5);
        digitalWrite(Relay3,HIGH); 
      //  delayMillis(5);
        digitalWrite(Relay4,HIGH);
      //  delayMillis(5);
        digitalWrite(Relay5,HIGH);
      //  delayMillis(5);
        digitalWrite(Relay6,HIGH);
      //  delayMillis(5);
        digitalWrite(Relay7,HIGH); 
      //  delayMillis(5);
      //  delay(20);   
        
                        
      }
      
      void initialization_relay_as_output(){
            pinMode(Relay0, OUTPUT);
            pinMode(Relay1, OUTPUT);
            pinMode(Relay2, OUTPUT);
            pinMode(Relay3, OUTPUT);
            pinMode(Relay4, OUTPUT); 
            pinMode(Relay5, OUTPUT);
            pinMode(Relay6, OUTPUT);
            pinMode(Relay7, OUTPUT); 
      }
      
      
      // Frequency is really important so delay with interruption couldn't be used 
      // USE instead delay with millis so i create this function delayMillis() for that
      void delayMillis(unsigned long duration) {
        unsigned long previousMillis = millis();   
        while (millis() - previousMillis < duration) {
        }
      }
      
      
      
      
      // SELECT ONE DEFINE FOR  DEBUGGING AND PRINTING
      #define ACTIVE_LCD 0 
      #define ACTIVE_LCD_OLED 1
      #define ACTIVE_LCD_1602 2
      
      // CHOOSE
      #define ACTIVE_LCD_OPTION ACTIVE_LCD_1602
      
      void print_serial_lcdoled_lcd1602(int voltage_begin, int voltage_stop){
          if (ACTIVE_LCD_OPTION == ACTIVE_LCD_1602)
          {
            
              // Print first text
              lcd.setCursor(0, 0);  // adjusted to the first line
              lcd.print(voltage_begin);
              lcd.print(" < V < ");
              lcd.print(voltage_stop);
           
              // print the second text
              lcd.setCursor(0, 1);  // adjusted to the second line
          
              lcd.print((int)input_Volts);
              lcd.print("->");
              lcd.print((int)output_Volts);
      
              lcd.display();  // refresh screen
          }
      
          if (ACTIVE_LCD_OPTION == ACTIVE_LCD_OLED)
          {
              // Print the firt text
              display.setCursor(0, 0);  // adjusted to the first line
              display.print(voltage_begin);
              display.print("<V<");
              display.print(voltage_stop);
           
              //print the second text
              display.setCursor(0, 16);  // adjusted to the second line
          
              display.print((int)input_Volts);
              display.print("->");
              display.print((int)output_Volts);
      
              display.display();  // refresh the screen
            
          }
      
          Serial.println();      
          Serial.print((int)input_Volts);
          Serial.print(" -> ");
          Serial.print((int)output_Volts);    
          Serial.println();
      
          Serial.print(voltage_begin);                  
          Serial.print(" < V <  ");
          Serial.print(voltage_stop);
          Serial.println();                         
        
          
          Serial.print(digitalRead(Relay0));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay1));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay2));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay3));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay4));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay5));      
          Serial.print(" ");      
          Serial.print(digitalRead(Relay6));      
          Serial.print(" ");      
          Serial.println(digitalRead(Relay7));           
          
        
      }
      
      void print_security_lowvoltage_serial_lcdoled_lcd1602(){
        if (ACTIVE_LCD != 1)
        {
      
          Serial.println();      
          Serial.print((int)input_Volts);
          Serial.print(" -> ");
          Serial.print((int)output_Volts);    
          Serial.println();
      
          Serial.print(" V < ");
          Serial.print(VOLTAGE_SECURITY_LOW);
          Serial.println();                         
        } 
        
      }
      
      void print_security_highvoltage_serial_lcdoled_lcd1602(){
       if (ACTIVE_LCD != 1)
        {
      
          Serial.println();      
          Serial.print((int)input_Volts);
          Serial.print(" -> ");
          Serial.print((int)output_Volts);    
          Serial.println();
      
          Serial.print(" V > ");
          Serial.print(VOLTAGE_SECURITY_HIGH);
          Serial.println();                         
        }
      
      }
      
      /*
      STABILIZER BY EACH TAPPING_STATE
      */
      
      void stabilizer_tapping_security_voltage(){
         // Something is anormal on voltage (really high or really low) 
         normal = 0;
         // Relay0 will be inactif so becomes HIGH
         if(Relay0_state == LOW){  
            digitalWrite(Relay0,HIGH); 
            delayMillis(5);
            Relay0_state = HIGH;
         }                        
      }
      
      void stabilizer_tapping_state1_94_231(){
        // Serial.println("voltage < VOLTAGE_TRANSITION_1");
        // STATE 1 ARDUINO RELAY: 
        // Relay1 -> Relay 7 : H H H H L L L
        // INPUT1 -> INPUT8 :L H H H H L L L
        // H means HIGH -> RELAY LED IS OFF
        // L means  LOW -> RELAY LED IS ON
        // inputtap = 94V and outpoutap = 231V
        // < VOLTAGE_TRANSITION_1 (near of 95)
        // verify interconnection of K2 MIDDLE and K8 UP
        // verify interconnection of K1 UP and K2 UP
        
        if(Relay1_state == LOW){
        digitalWrite(Relay1,HIGH);
        delayMillis(5);
        Relay1_state = HIGH;
        }
        
        if(Relay2_state == LOW){  
        digitalWrite(Relay2,HIGH);
        delayMillis(5);
        Relay2_state = HIGH;
        }   
        
        if(Relay3_state == LOW){ 
        digitalWrite(Relay3,HIGH);
        delayMillis(5);
        Relay3_state = HIGH;
        }
        
        if(Relay4_state == LOW){                        
        digitalWrite(Relay4,HIGH);
        delayMillis(5);
        Relay4_state = HIGH;
        }
        
        if(Relay5_state == HIGH){
        digitalWrite(Relay5,LOW);
        delayMillis(5);
        Relay5_state = LOW;
        }
        
        if(Relay6_state == HIGH){    
        digitalWrite(Relay6,LOW);
        delayMillis(5);
        Relay6_state = LOW;                        
        }
        
        if(Relay7_state == HIGH){    
        digitalWrite(Relay7,LOW);
        delayMillis(5);
        Relay7_state = LOW;                        
        }
      }
      
      void stabilizer_tapping_state2_94_215(){
        // STATE 2 ARDUINO RELAY: 
        // Relay1 -> Relay7  : H  L  H H L L L
        // INPUT1 -> INPUT8: L H  L  H H L L L
        // H means HIGH -> RELAY LED IS OFF
        // L means  LOW -> RELAY LED IS ON
        // inputtap = 109V and outpoutap = 215V
        // < VOLTAGE_TRANSITION_2 (near of 105V)
        // verify interconnection with K2 MIDDLE and K8 UP
        // verify interconnection with K1 UP and K3 UP
         
        if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
        if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
        }   
        if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
        }
        if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
        }
        if(Relay5_state == HIGH){                      
          digitalWrite(Relay5,LOW);
          delayMillis(5);                        
          Relay5_state = LOW;
        }
        if(Relay6_state == HIGH){    
          digitalWrite(Relay6,LOW);
          delayMillis(5);                        
          Relay6_state = LOW;                        
        }
        if(Relay7_state == HIGH){    
          digitalWrite(Relay7,LOW);
          delayMillis(5);                        
          Relay7_state = LOW;                        
        }  
      }
      
      void stabilizer_tapping_state3_109_215(){
      // STATE 3 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H H L L H
      // INPUT1 -> INPUT8: L H  L H H L L H
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 109V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_3 (near of 115V)
      // verify interconnection of K2 MIDDLE AND K8 DOWN 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
       }
       if(Relay5_state == HIGH){                      
          digitalWrite(Relay5,LOW);
          delayMillis(5);                        
          Relay5_state = LOW;
       }
       if(Relay6_state == HIGH){    
          digitalWrite(Relay6,LOW);
          delayMillis(5);                        
          Relay6_state = LOW;                        
       }
       if(Relay7_state == LOW){    
          digitalWrite(Relay7,HIGH);
          delayMillis(5);                        
          Relay7_state = HIGH;                        
       }
       
      }
      
      void stabilizer_tapping_state4_127_215(){
      // STATE 4 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H H L H X
      // INPUT1 -> INPUT8: L H  L H H L H X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 127V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_4 (near of 132V)
      // verify interconnection of K2 MIDDLE AND K7 DOWN 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
       }
       if(Relay5_state == HIGH){                      
          digitalWrite(Relay5,LOW);
          delayMillis(5);                        
          Relay5_state = LOW;
       }
       if(Relay6_state == LOW){    
          digitalWrite(Relay6,HIGH);
          delayMillis(5);                        
          Relay6_state = HIGH;                        
       }
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
        
      }
      
      void stabilizer_tapping_state5_148_215(){
      // STATE 5 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H H H X X
      // INPUT1 -> INPUT8: L H  L H H H X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 148V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_5 (near of 153)
      // verify interconnection of K2 MIDDLE AND K6 DOWN 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == LOW){                        
          digitalWrite(Relay4,HIGH);
          delayMillis(5);                        
          Relay4_state = HIGH;
       }
       if(Relay5_state == LOW){                      
          digitalWrite(Relay5,HIGH);
          delayMillis(5);                        
          Relay5_state = HIGH;
       }
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
      }
      
      
      void stabilizer_tapping_state6_171_231(){
      // STATE 6 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  H H L X X X
      // INPUT1 -> INPUT8: L H  H H L X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 171V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_6 (near of 160)
      // verify interconnection of K2 MIDDLE AND K5 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == HIGH){                        
          digitalWrite(Relay4,LOW);
          delayMillis(5);                        
          Relay4_state = LOW;
       }
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
      }
      
      void stabilizer_tapping_state7_171_215(){
        
      // STATE 7 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L H L X X X
      // INPUT1 -> INPUT8: L H  L H L X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 171V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_7 (near of 176)
      // verify interconnection of K2 MIDDLE AND K5 UP 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == LOW){ 
          digitalWrite(Relay3,HIGH);
          delayMillis(5);                        
          Relay3_state = HIGH;
       }
       if(Relay4_state == HIGH){                        
          digitalWrite(Relay4,LOW);
          delayMillis(5);                        
          Relay4_state = LOW;
       }
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
         
      }
      
      
      void stabilizer_tapping_state8_199_231(){
      // STATE 8 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  H L X X X X
      // INPUT1 -> INPUT8: L H  H L X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 199V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_8 (near of 188)
      // verify interconnection of K2 MIDDLE AND K4 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       if(Relay3_state == HIGH){ 
          digitalWrite(Relay3,LOW);
          delayMillis(5);                        
          Relay3_state = LOW;
       }
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
        
      }
      
      void stabilizer_tapping_state9_199_215(){
        
      // STATE 9 ARDUINO RELAY: 
      // Relay1 -> Relay7  : H  L L X X X X
      // INPUT1 -> INPUT8: L H  L L X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 199V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_9 (near of 204)
      // verify interconnection of K2 MIDDLE AND K4 UP 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == LOW){
          digitalWrite(Relay1,HIGH);
          delayMillis(5);
          Relay1_state = HIGH;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       if(Relay3_state == HIGH){ 
          digitalWrite(Relay3,LOW);
          delayMillis(5);                        
          Relay3_state = LOW;
       }
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
      
      }
      
      void stabilizer_tapping_state10_231_231(){  
      // STATE 10 ARDUINO RELAY: 
      // Relay1 -> Relay7  : L  H X X X X X
      // INPUT1 -> INPUT8: L L  H X X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 231V and outpoutap = 231V
      // < VOLTAGE_TRANSITION_10 (near of 235)
      // verify interconnection of K2 MIDDLE AND K2 UP 
      // verify interconnection of K1 UP AND K2 UP
      
       if(Relay1_state == HIGH){
          digitalWrite(Relay1,LOW);
          delayMillis(5);
          Relay1_state = LOW;
        }
          
       if(Relay2_state == LOW){  
          digitalWrite(Relay2,HIGH);
          delayMillis(5);                        
          Relay2_state = HIGH;
       }   
       //if(Relay3_state == HIGH){ 
       //   digitalWrite(Relay3,LOW);
       //   delayMillis(5);                        
       //   Relay3_state = LOW;
       //}
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}
        
      }
      
      
      void stabilizer_tapping_state11_231_215(){
      // STATE 11 ARDUINO RELAY: 
      // Relay1 -> Relay7  : L  L X X X X X
      // INPUT1 -> INPUT8: L L  L X X X X X
      // H means HIGH -> RELAY LED IS OFF
      // L means  LOW -> RELAY LED IS ON
      // inputtap = 231V and outpoutap = 215V
      // < VOLTAGE_TRANSITION_11 (near of 260)
      // verify interconnection of K2 MIDDLE AND K2 UP 
      // verify interconnection of K1 UP AND K3 UP
      
       if(Relay1_state == HIGH){
          digitalWrite(Relay1,LOW);
          delayMillis(5);
          Relay1_state = LOW;
        }
          
       if(Relay2_state == HIGH){  
          digitalWrite(Relay2,LOW);
          delayMillis(5);                        
          Relay2_state = LOW;
       }   
       //if(Relay3_state == HIGH){ 
       //   digitalWrite(Relay3,LOW);
       //   delayMillis(5);                        
       //   Relay3_state = LOW;
       //}
       //if(Relay4_state == HIGH){                        
       //   digitalWrite(Relay4,LOW);
       //   delayMillis(5);                        
       //   Relay4_state = LOW;
       //}
       //if(Relay5_state == LOW){                      
       //   digitalWrite(Relay5,HIGH);
       //   delayMillis(5);                        
       //   Relay5_state = HIGH;
       //}
       //if(Relay6_state == LOW){    
       //   digitalWrite(Relay6,HIGH);
       //   delayMillis(5);                        
       //   Relay6_state = HIGH;                        
       //}
       //if(Relay7_state == LOW){    
       //   digitalWrite(Relay7,HIGH);
       //   delayMillis(5);                        
       //   Relay7_state = HIGH;                        
       //}  
        
      }
      
      void stabilize_voltage_with_arduino(void){
           unsigned char V_LOW_CUT;
      
            // TEST and calibrate before running this part
           Voltage_INT = (unsigned int) input_Volts;
      
           if (normal == 1){
              V_LOW_CUT = VOLTAGE_SECURITY_LOW+5;
           }
           else{
              V_LOW_CUT = VOLTAGE_SECURITY_LOW;
           }
      
      
           if (Voltage_INT < V_LOW_CUT){              /*    Low Cut Check    */
              stabilizer_tapping_security_voltage();
              print_security_lowvoltage_serial_lcdoled_lcd1602();
              oldVoltage = V_LOW_CUT;
           }
           else if (Voltage_INT > VOLTAGE_SECURITY_HIGH){         /*    High Cut Check   */
              stabilizer_tapping_security_voltage();
              print_security_highvoltage_serial_lcdoled_lcd1602();
              oldVoltage = VOLTAGE_SECURITY_HIGH;
           }
           else{                                /* Normal --> Stabilize */
              normal = 1;
              if (Voltage_INT > oldVoltage){
                  V_DIFFERENCE = Voltage_INT - oldVoltage;
              }
              else{
                  V_DIFFERENCE = oldVoltage - Voltage_INT;
              }
      
              if (V_DIFFERENCE >= HYSTERESIS){
                        if (Voltage_INT < VOLTAGE_TRANSITION_1){
                          
                           stabilizer_tapping_state1_94_231(); 
                           print_serial_lcdoled_lcd1602(40, VOLTAGE_TRANSITION_1);                                           
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_1;
      
                        }
                        else if (Voltage_INT < VOLTAGE_TRANSITION_2){
                          
                          stabilizer_tapping_state2_94_215();  
                          print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_1, VOLTAGE_TRANSITION_2);                                                                                                      
                          oldVoltage = (unsigned int)VOLTAGE_TRANSITION_2;
                           
                        }
                        else if (Voltage_INT < VOLTAGE_TRANSITION_3){
      
                           stabilizer_tapping_state3_109_215();                  
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_2, VOLTAGE_TRANSITION_3);
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_3;   
                        }
                        else if (Voltage_INT < VOLTAGE_TRANSITION_4){
                           
                           stabilizer_tapping_state4_127_215(); 
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_3, VOLTAGE_TRANSITION_4);                 
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_4;
      
                        }else if (Voltage_INT < VOLTAGE_TRANSITION_5){
                                             
                           stabilizer_tapping_state5_148_215(); 
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_4, VOLTAGE_TRANSITION_5);                 
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_5;
                       }
                        else if (Voltage_INT < VOLTAGE_TRANSITION_6){
                           
                           stabilizer_tapping_state6_171_231();    
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_5, VOLTAGE_TRANSITION_6);              
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_6;
      
                        }else if (Voltage_INT < VOLTAGE_TRANSITION_7){
                                                                
                           stabilizer_tapping_state7_171_215();  
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_6, VOLTAGE_TRANSITION_7);                
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_7;
      
                        }else if (Voltage_INT < VOLTAGE_TRANSITION_8){
                           
                           stabilizer_tapping_state8_199_231();
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_7, VOLTAGE_TRANSITION_8);                  
                           oldVoltage = (unsigned int)VOLTAGE_TRANSITION_8;    
                                            
                        }else  if (Voltage_INT < VOLTAGE_TRANSITION_9){
                           
                           stabilizer_tapping_state9_199_215();  
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_8, VOLTAGE_TRANSITION_9);                                     
                           oldVoltage = (unsigned int)(VOLTAGE_TRANSITION_9); 
                           
                        }else  if (Voltage_INT < VOLTAGE_TRANSITION_10){
                           
                           stabilizer_tapping_state10_231_231();   
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_9, VOLTAGE_TRANSITION_10);                                    
                           oldVoltage = (unsigned int)(VOLTAGE_TRANSITION_10); 
                           
                        } else  if (Voltage_INT < VOLTAGE_TRANSITION_11){
                           
                           stabilizer_tapping_state11_231_215();                  
                           print_serial_lcdoled_lcd1602(VOLTAGE_TRANSITION_10, VOLTAGE_TRANSITION_11);
                           oldVoltage = (unsigned int)(VOLTAGE_TRANSITION_11); 
                           
                        }else {
                           // Very high voltage ; so, make security high voltage
                           print_security_highvoltage_serial_lcdoled_lcd1602();
                           stabilizer_tapping_security_voltage(); 
                           oldVoltage = (unsigned int)(VOLTAGE_TRANSITION_11); 
                        }
                }
                 
                
                if (normal == 1){
                   // Main relay activate, so the stabilization run correctly with outvolts
                   if(Relay0_state == HIGH){  
                      digitalWrite(Relay0,LOW); 
                      delayMillis(5);                
                      Relay0_state = LOW;
                   }               
                   delayMillis(50);  
                }
                else{       
                   // Main relay activate, so the stabilization run correctly with outvolts
                   if(Relay0_state == LOW){  
                      digitalWrite(Relay0,HIGH); 
                      delayMillis(5);
      
                      Relay0_state = HIGH;
                   } 
                     
                   delayMillis(50);  
                }  
           }       
      }
      
      
      
      
      
      void setup() {
        // initialization of serial port
        Serial.begin(9600);    
      
        // initialization of LCD
        if(ACTIVE_LCD_OPTION == ACTIVE_LCD_1602){
          lcd.init();
          lcd.backlight();    
        }
        
        if(ACTIVE_LCD_OPTION == ACTIVE_LCD_OLED){
          if (!display.begin(SSD1306_SWITCHCAPVCC, OLED_ADDRESS)) {
              Serial.println(F("√âchec de l'initialisation de l'√©cran OLED"));
              for (;;);
          }
      
          display.clearDisplay();  // Effacer l'√©cran
      
          display.setTextSize(1);  // Taille du texte (2x plus grand)
          display.setTextColor(SSD1306_WHITE);
        }
      
        
        // initialization of involtage and outvoltage
        pinMode(A2, INPUT);
        pinMode(A3, INPUT);
        
        // initialization relay: 
        initialization_relay_as_output();
        initialization_relay_state_arduino_relay();
        initialization_relay_arduino_relay();      
       
        delay(20);
        
      }
      
      void loop() {
        RunningStatistics outputStats;                  // Easy computing statics for the RMS of voltage input
        outputStats.setWindowSecs(windowLength);
        
        RunningStatistics inputStats;                  //Easy computing statics for the RMS of voltage input
        inputStats.setWindowSecs(windowLength);
        
        while (true) {
          outSensor = analogRead(A3);                     // defined as analogue input A3
          outputStats.input(outSensor);                    // save the output voltage for calculating RMS
        
          inSensor = analogRead(A2);                     // defined as analogue input A2
          inputStats.input(inSensor);                      // save the output voltage for calculating RMS
        
        
        if(isWarmUpComplete == false){
        
            // initialization relay: 
            initialization_relay_as_output();
            initialization_relay_state_arduino_relay();
            initialization_relay_arduino_relay();      
          }
        
           
          // verify if the time to wait for having all rms data of input voltage is complete
          if (millis() - startTime >= warmUpTime) {
            //initialization_relay_state_arduino_relay();
            //initialization_relay_arduino_relay();            
            isWarmUpComplete = true;
          }
        
        
          // the time to wait for having all rms data of input voltage is complete
          if (((unsigned long)(millis() - previousMillis) >= printPeriod) && isWarmUpComplete){
            previousMillis = millis();                 // update timing
        
            output_Volts = intercept + slope2 * outputStats.sigma(); // do calibration of offset and amplitude for output voltage
            output_Volts = output_Volts;                // do calibration of offset and amplitude for output voltage
        
            input_Volts = intercept + slope1 * inputStats.sigma(); // do calibration of offset and amplitude for input voltage
            input_Volts = input_Volts;                // do calibration of offset and amplitude for input voltage
        
            stabilize_voltage_with_arduino();
        
            
          }
        }
      }        
      
  </tr>
</table>  

## TEST INTEGRATION
For selection of LCD
```
#define ACTIVE_LCD 0 
#define ACTIVE_LCD_OLED 1
#define ACTIVE_LCD_1602 2

// CHOOSE
#define ACTIVE_LCD_OPTION ACTIVE_LCD_1602
```

For configuring sensor
```
float slope1 = 2.59;                // For adjusting the test calibration for involtage or outvoltage
float slope2 = 2.60;                // For adjusting the test calibration for involtage or outvoltage
```

For configuring warm_up
```
unsigned long warmUpTime = 8000; // Time to wait for initialization of the voltage sensor to collect all data before RMS is 8 secondes
```

For configuring transitions of all states
```
// Minus is the calibration of voltage transition , 
// no calibration, it will be 0
// more high output, it will  be negatif as eg : -3
// more low output, it will be positif as eg : +3
#define MINIUS 0

#define VOLTAGE_TRANSITION_1 100-MINIUS //first transition is near 90V 
#define VOLTAGE_TRANSITION_2 110-MINIUS //second transition is near 105
#define VOLTAGE_TRANSITION_3 124-MINIUS // third transition is near 115 //interesting
#define VOLTAGE_TRANSITION_4 137-MINIUS // fourth transition is near 130 //The first modif 145
#define VOLTAGE_TRANSITION_5 155-MINIUS // fifth transition is near 150
#define VOLTAGE_TRANSITION_6 165-MINIUS // sixth transition is near 160
#define VOLTAGE_TRANSITION_7 185-MINIUS // seventh transition is near 175
#define VOLTAGE_TRANSITION_8 200-MINIUS // eigth transition is near 190
#define VOLTAGE_TRANSITION_9 210-MINIUS // ninetransition is near 205
#define VOLTAGE_TRANSITION_10 230-MINIUS // ninetransition is near 230
#define VOLTAGE_TRANSITION_11 255-MINIUS // ninetransition is near 255
```

For configuring security voltage
```
// SECURITY VOLTAGE
#define VOLTAGE_SECURITY_LOW 45
#define VOLTAGE_SECURITY_HIGH VOLTAGE_TRANSITION_11+5
```

For configuring hysteresis
```
#define HYSTERESIS 2
```





# X - PIN TO KNOW
* PIN OF EXTRA TRANSFORMATOR
<table>
    <tr>
        <td>
            <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/PIN_EXTRA_TRANSFO.jpg" width="200" alt="Image des pins extra transformateur">
        </td>
        <td>
            <img src="https://raw.githubusercontent.com/SitrakaResearchAndPOC/electricity_zero_down_time_haifa_udr/main/PATCHED_WITH_RELAY/PIN_EXTRA_TRANSFO_NOTATION.jpg" width="200" alt="Image des pins extra transformateur avec notation">
        </td>
    </tr>
</table>
